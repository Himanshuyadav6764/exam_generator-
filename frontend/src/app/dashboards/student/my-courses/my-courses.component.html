<div class="courses-container">
    <!-- Header -->
    <header class="courses-header">
        <div class="header-content">
            <button class="btn-back" (click)="goToDashboard()">
                <i class="fas fa-arrow-left"></i> Back to Dashboard
            </button>
            <div class="header-info">
                <h1><i class="fas fa-book-open"></i> My Courses</h1>
                <p>Explore and continue your learning journey</p>
            </div>
            <div class="user-info">
                <div class="user-avatar">{{ userInitials }}</div>
                <span>{{ fullName }}</span>
            </div>
        </div>
    </header>

    <!-- Loading State -->
    <div *ngIf="loading" class="loading-state">
        <div class="spinner"></div>
        <p>Loading courses...</p>
    </div>

    <!-- Error State -->
    <div *ngIf="error && !loading" class="error-state">
        <i class="fas fa-exclamation-triangle"></i>
        <p>{{ error }}</p>
        <button class="btn-retry" (click)="loadPublishedCourses()">
            <i class="fas fa-redo"></i> Retry
        </button>
    </div>

    <!-- Courses Grid -->
    <div *ngIf="!loading && !error" class="courses-content">
        <!-- Search Bar -->
        <div class="search-section">
            <div class="search-container">
                <i class="fas fa-search search-icon"></i>
                <input 
                    type="text" 
                    class="search-input" 
                    [(ngModel)]="searchQuery"
                    (input)="searchCourses()"
                    placeholder="Search courses by title, instructor, subject, or difficulty...">
                <button *ngIf="searchQuery" class="clear-btn" (click)="clearSearch()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="search-results-info" *ngIf="searchQuery">
                <span>Found {{ filteredCourses.length }} course(s)</span>
            </div>
        </div>

        <div class="courses-stats">
            <div class="stat-card">
                <i class="fas fa-graduation-cap"></i>
                <div class="stat-info">
                    <span class="stat-value">{{ filteredCourses.length }}</span>
                    <span class="stat-label">{{ searchQuery ? 'Search Results' : 'Available Courses' }}</span>
                </div>
            </div>
        </div>

        <!-- Empty State -->
        <div *ngIf="filteredCourses.length === 0" class="empty-state">
            <i class="fas fa-inbox"></i>
            <h2>{{ searchQuery ? 'No Courses Found' : 'No Courses Available' }}</h2>
            <p>{{ searchQuery ? 'Try adjusting your search terms' : 'Check back later for new courses from your instructors' }}</p>
            <button *ngIf="searchQuery" class="btn-retry" (click)="clearSearch()">
                <i class="fas fa-redo"></i> Clear Search
            </button>
        </div>

        <!-- Courses Grid -->
        <div *ngIf="filteredCourses.length > 0" class="courses-grid">
            <div *ngFor="let course of filteredCourses" class="course-card">
                <div class="course-image">
                    <img [src]="course.thumbnailUrl || 'assets/default-course.jpg'" 
                         [alt]="course.title"
                         (error)="$any($event.target).src='assets/default-course.jpg'">
                    <div class="course-overlay">
                        <div class="badge-container">
                            <span class="difficulty-badge" 
                                  [style.background-color]="getDifficultyColor(course.difficulty)">
                                <i class="fas" [ngClass]="getDifficultyIcon(course.difficulty)"></i>
                                {{ course.difficulty || 'BEGINNER' }}
                            </span>
                            <span *ngIf="isEnrolled(course.id)" class="enrolled-badge">
                                <i class="fas fa-check-circle"></i> Enrolled
                            </span>
                        </div>
                    </div>
                </div>

                <div class="course-content">
                    <h3>{{ course.title }}</h3>
                    <p class="course-description">{{ course.description || 'No description available' }}</p>

                    <div class="course-meta">
                        <div class="meta-item">
                            <i class="fas fa-user-tie"></i>
                            <span>{{ course.instructorName || course.instructorEmail }}</span>
                        </div>
                        <div class="meta-item">
                            <i class="fas fa-layer-group"></i>
                            <span>{{ course.topics?.length || 0 }} Topics</span>
                        </div>
                    </div>

                    <div class="course-subjects" *ngIf="course.subjects && course.subjects.length > 0">
                        <span *ngFor="let subject of course.subjects" class="subject-tag">
                            {{ subject }}
                        </span>
                    </div>

                    <div class="course-actions">
                        <!-- Show Enroll button if not enrolled -->
                        <button *ngIf="!isEnrolled(course.id)" class="btn-enroll" (click)="enrollCourse(course)">
                            <i class="fas fa-user-plus"></i> Enroll Now
                        </button>
                        
                        <!-- Show Start Learning if enrolled -->
                        <button *ngIf="isEnrolled(course.id)" class="btn-enrolled" (click)="startCourse(course)">
                            <i class="fas fa-check-circle"></i> Enrolled
                        </button>
                        
                        <button class="btn-details" (click)="viewCourseDetails(course)">
                            <i class="fas fa-info-circle"></i> Details
                        </button>
                        
                        <button class="btn-recommend" (click)="addToRecommendations(course, $event)">
                            <i class="fas fa-star"></i> Add to Recommendations
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Course Details Modal -->
<div class="modal-overlay" *ngIf="showDetailsModal" (click)="closeDetailsModal()">
    <div class="modal-content" (click)="$event.stopPropagation()">
        <div class="modal-header">
            <h2><i class="fas fa-info-circle"></i> Course Details</h2>
            <button class="btn-close" (click)="closeDetailsModal()">
                <i class="fas fa-times"></i>
            </button>
        </div>

        <div class="modal-body" *ngIf="!loadingDetails && courseDetails">
            <div class="course-title">
                <h3>{{ selectedCourse?.title }}</h3>
                <p class="course-instructor">
                    <i class="fas fa-user-tie"></i> {{ selectedCourse?.instructorName || selectedCourse?.instructorEmail }}
                </p>
            </div>

            <!-- Stats Summary -->
            <div class="stats-grid">
                <div class="stat-box">
                    <div class="stat-icon topics"><i class="fas fa-layer-group"></i></div>
                    <div class="stat-content">
                        <span class="stat-number">{{ courseDetails.totalTopics || 0 }}</span>
                        <span class="stat-label">Topics</span>
                    </div>
                </div>
                <div class="stat-box">
                    <div class="stat-icon subtopics"><i class="fas fa-sitemap"></i></div>
                    <div class="stat-content">
                        <span class="stat-number">{{ courseDetails.totalSubtopics || 0 }}</span>
                        <span class="stat-label">Subtopics</span>
                    </div>
                </div>
                <div class="stat-box">
                    <div class="stat-icon videos"><i class="fas fa-video"></i></div>
                    <div class="stat-content">
                        <span class="stat-number">{{ courseDetails.totalVideos || 0 }}</span>
                        <span class="stat-label">Videos</span>
                    </div>
                </div>
                <div class="stat-box">
                    <div class="stat-icon pdfs"><i class="fas fa-file-pdf"></i></div>
                    <div class="stat-content">
                        <span class="stat-number">{{ courseDetails.totalPdfs || 0 }}</span>
                        <span class="stat-label">PDFs</span>
                    </div>
                </div>
                <div class="stat-box">
                    <div class="stat-icon mcqs"><i class="fas fa-question-circle"></i></div>
                    <div class="stat-content">
                        <span class="stat-number">{{ courseDetails.totalMcqs || 0 }}</span>
                        <span class="stat-label">MCQs</span>
                    </div>
                </div>
                <div class="stat-box">
                    <div class="stat-icon ai-quiz"><i class="fas fa-robot"></i></div>
                    <div class="stat-content">
                        <span class="stat-number">{{ courseDetails.totalAiQuizzes || 0 }}</span>
                        <span class="stat-label">AI Quizzes</span>
                    </div>
                </div>
            </div>

            <!-- Topics Breakdown -->
            <div class="topics-section">
                <h4><i class="fas fa-list"></i> Topics Breakdown</h4>
                <div class="topics-list" *ngIf="courseDetails.topics && courseDetails.topics.length > 0">
                    <div *ngFor="let topic of courseDetails.topics; let i = index" class="topic-item">
                        <div class="topic-header">
                            <span class="topic-icon">{{ getTopicIcon(i) }}</span>
                            <span class="topic-name">{{ topic.name || topic }}</span>
                        </div>
                        <div class="topic-details" *ngIf="topic.subtopics">
                            <div class="detail-row">
                                <i class="fas fa-sitemap"></i>
                                <span>{{ topic.subtopics?.length || 0 }} Subtopics</span>
                            </div>
                            <div class="detail-row" *ngIf="topic.videosCount !== undefined">
                                <i class="fas fa-video"></i>
                                <span>{{ topic.videosCount }} Videos</span>
                            </div>
                            <div class="detail-row" *ngIf="topic.pdfsCount !== undefined">
                                <i class="fas fa-file-pdf"></i>
                                <span>{{ topic.pdfsCount }} PDFs</span>
                            </div>
                            <div class="detail-row" *ngIf="topic.mcqsCount !== undefined">
                                <i class="fas fa-question-circle"></i>
                                <span>{{ topic.mcqsCount }} MCQs</span>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="no-topics" *ngIf="!courseDetails.topics || courseDetails.topics.length === 0">
                    <p>No topics available for this course yet.</p>
                </div>
            </div>
        </div>

        <div class="modal-loading" *ngIf="loadingDetails">
            <div class="spinner"></div>
            <p>Loading course details...</p>
        </div>

        <div class="modal-footer">
            <button class="btn-secondary" (click)="closeDetailsModal()">
                <i class="fas fa-times"></i> Close
            </button>
            <button *ngIf="!isEnrolled(selectedCourse?.id)" class="btn-primary" (click)="enrollCourse(selectedCourse); closeDetailsModal()">
                <i class="fas fa-user-plus"></i> Enroll Now
            </button>
            <button *ngIf="isEnrolled(selectedCourse?.id)" class="btn-success" (click)="startCourse(selectedCourse); closeDetailsModal()">
                <i class="fas fa-play"></i> Start Learning
            </button>
        </div>
    </div>
</div>
