<div class="form-container">
  <div class="form-header">
    <h1>{{ isEditMode ? 'Edit Subject' : 'Create New Subject' }}</h1>
    <p class="subtitle">{{ isEditMode ? 'Update subject information' : 'Add a new subject to the platform' }}</p>
  </div>

  <div *ngIf="loading" class="loading">
    <div class="spinner"></div>
    <p>{{ isEditMode ? 'Saving subject...' : 'Creating subject...' }}</p>
  </div>

  <div *ngIf="successMessage" class="success-message">
    <span class="icon">‚úÖ</span>
    <span>{{ successMessage }}</span>
  </div>

  <div *ngIf="error" class="error-message">
    <span class="icon">‚ö†Ô∏è</span>
    <span>{{ error }}</span>
  </div>

  <form [formGroup]="subjectForm" (ngSubmit)="onSubmit()" *ngIf="!loading && !successMessage">
    <!-- Title Field -->
    <div class="form-group">
      <label for="title">Subject Title <span class="required">*</span></label>
      <input 
        type="text" 
        id="title" 
        formControlName="title" 
        placeholder="e.g., Data Structures and Algorithms"
        [class.invalid]="title?.invalid && title?.touched">
      <div class="error-text" *ngIf="title?.invalid && title?.touched">
        <span *ngIf="title?.errors?.['required']">Title is required</span>
        <span *ngIf="title?.errors?.['minlength']">Title must be at least 3 characters</span>
        <span *ngIf="title?.errors?.['maxlength']">Title cannot exceed 100 characters</span>
      </div>
    </div>

    <!-- Description Field -->
    <div class="form-group">
      <label for="description">Description <span class="required">*</span></label>
      <textarea 
        id="description" 
        formControlName="description" 
        rows="4" 
        placeholder="Provide a detailed description of the subject"
        [class.invalid]="description?.invalid && description?.touched"></textarea>
      <div class="error-text" *ngIf="description?.invalid && description?.touched">
        <span *ngIf="description?.errors?.['required']">Description is required</span>
        <span *ngIf="description?.errors?.['minlength']">Description must be at least 10 characters</span>
        <span *ngIf="description?.errors?.['maxlength']">Description cannot exceed 500 characters</span>
      </div>
    </div>

    <!-- Difficulty Field -->
    <div class="form-group">
      <label for="difficulty">Difficulty Level <span class="required">*</span></label>
      <div class="difficulty-selector">
        <label *ngFor="let level of difficultyLevels" 
               class="difficulty-option" 
               [class.selected]="difficulty?.value === level.value">
          <input 
            type="radio" 
            formControlName="difficulty" 
            [value]="level.value">
          <div class="option-content" [style.border-color]="level.color">
            <span class="icon">{{ level.icon }}</span>
            <span class="label">{{ level.label }}</span>
          </div>
        </label>
      </div>
    </div>

    <!-- Instructor Email Field -->
    <div class="form-group">
      <label for="instructorEmail">Instructor Email <span class="required">*</span></label>
      <input 
        type="email" 
        id="instructorEmail" 
        formControlName="instructorEmail" 
        placeholder="instructor@example.com"
        [class.invalid]="instructorEmail?.invalid && instructorEmail?.touched">
      <div class="error-text" *ngIf="instructorEmail?.invalid && instructorEmail?.touched">
        <span *ngIf="instructorEmail?.errors?.['required']">Instructor email is required</span>
        <span *ngIf="instructorEmail?.errors?.['email']">Please enter a valid email</span>
      </div>
    </div>

    <!-- Status Field -->
    <div class="form-group" *ngIf="currentUserRole === 'ADMIN' || isEditMode">
      <label for="status">Status</label>
      <select id="status" formControlName="status" class="status-select">
        <option value="DRAFT">Draft (Not visible to students)</option>
        <option value="PUBLISHED">Published (Visible to students)</option>
      </select>
    </div>

    <!-- Thumbnail Upload -->
    <div class="form-group">
      <label for="thumbnail">Subject Thumbnail</label>
      <div class="thumbnail-upload">
        <div *ngIf="thumbnailPreview" class="thumbnail-preview">
          <img [src]="thumbnailPreview" alt="Thumbnail preview">
          <button type="button" class="btn-remove" (click)="removeThumbnail()">
            <span>‚úñ</span>
          </button>
        </div>

        <div *ngIf="!thumbnailPreview" class="upload-area">
          <input 
            type="file" 
            id="thumbnail" 
            accept="image/*" 
            (change)="onThumbnailSelect($event)"
            hidden
            #thumbnailInput>
          <label for="thumbnail" class="upload-label">
            <span class="icon">üì∑</span>
            <span>Click to upload thumbnail</span>
            <span class="hint">PNG, JPG up to 5MB</span>
          </label>
        </div>
      </div>
    </div>

    <!-- Form Actions -->
    <div class="form-actions">
      <button type="button" class="btn btn-cancel" (click)="cancel()">
        Cancel
      </button>
      <button type="submit" class="btn btn-submit" [disabled]="subjectForm.invalid">
        {{ isEditMode ? 'Update Subject' : 'Create Subject' }}
      </button>
    </div>
  </form>
</div>
